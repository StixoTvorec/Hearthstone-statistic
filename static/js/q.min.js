(function(n){if("function"===typeof bootstrap)bootstrap("promise",n);else if("object"===typeof exports&&"object"===typeof module)module.exports=n();else if("function"===typeof define&&define.amd)define(n);else if("undefined"!==typeof ses)ses.ok()&&(ses.makeQ=n);else if("undefined"!==typeof self)self.Q=n();else throw Error("This environment was not anticiapted by Q. Please file a bug.");})(function(){function n(a){return function(){return S.apply(a,arguments)}}function G(a,b){if(x&&b.stack&&"object"===
typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf("From previous event:")){for(var c=[],e=b;e;e=e.source)e.stack&&c.unshift(e.stack);c.unshift(a.stack);for(var c=c.join("\nFrom previous event:\n").split("\n"),e=[],d=0;d<c.length;++d){var h=c[d],k;if(k=H(h)){var I=k[1];k=k[0]===J&&I>=T&&I<=U}else k=!1;k||(k=h,k=-1!==k.indexOf("(module.js:")||-1!==k.indexOf("(node.js:"));k||!h||e.push(h)}c=e.join("\n");a.stack=c}}function H(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b||(b=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a)))return[b[1],
Number(b[2])];if(a=/.*@(.+):(\d+)$/.exec(a))return[a[1],Number(a[2])]}function K(){if(x)try{throw Error();}catch(a){var b=a.stack.split("\n"),b=0<b[0].indexOf("@")?b[1]:b[2];if(b=H(b))return J=b[0],b[1]}}function c(a){return a instanceof d?a:L(a)?V(a):A(a)}function l(){function a(a){e=a;h.source=a;y(b,function(b,g){c.nextTick(function(){a.promiseDispatch.apply(a,g)})},void 0);g=b=void 0}var b=[],g=[],e,m=B(l.prototype),h=B(d.prototype);h.promiseDispatch=function(a,d,h){var m=f(arguments);b?(b.push(m),
"when"===d&&h[1]&&g.push(h[1])):c.nextTick(function(){e.promiseDispatch.apply(e,m)})};h.valueOf=function(){if(b)return h;var a=M(e);p(a)&&(e=a);return a};h.inspect=function(){return e?e.inspect():{state:"pending"}};if(c.longStackSupport&&x)try{throw Error();}catch(k){h.stack=k.stack.substring(k.stack.indexOf("\n")+1)}m.promise=h;m.resolve=function(b){e||a(c(b))};m.fulfill=function(b){e||a(A(b))};m.reject=function(b){e||a(q(b))};m.notify=function(a){e||y(g,function(b,g){c.nextTick(function(){g(a)})},
void 0)};return m}function t(a){if("function"!==typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function N(a){return t(function(b,g){for(var e=0,d=a.length;e<d;e++)c(a[e]).then(b,g)})}function d(a,b,c){void 0===b&&(b=function(a){return q(Error("Promise does not support operation: "+a))});void 0===c&&(c=function(){return{state:"unknown"}});var e=B(d.prototype);e.promiseDispatch=function(c,g,d){var m;try{m=
a[g]?a[g].apply(e,d):b.call(e,g,d)}catch(f){m=q(f)}c&&c(m)};if(e.inspect=c){var m=c();"rejected"===m.state&&(e.exception=m.reason);e.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?e:a.value}}return e}function r(a,b,g,e){return c(a).then(b,g,e)}function M(a){if(p(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function p(a){return a instanceof d}function L(a){return a===Object(a)&&"function"===typeof a.then}function C(){v.length=0;z.length=0;w||
(w=!0)}function W(a,b){w&&(z.push(a),b&&"undefined"!==typeof b.stack?v.push(b.stack):v.push("(no stack) "+b))}function q(a){var b=d({when:function(b){if(b&&w){var c=X(z,this);-1!==c&&(z.splice(c,1),v.splice(c,1))}return b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});W(b,a);return b}function A(a){return d({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===
b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return Y(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function V(a){var b=l();c.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}});return b.promise}function O(a,b,g){return c(a).spread(b,g)}function P(a,b,g){return c(a).dispatch(b,g)}function u(a){return r(a,function(a){var c=0,e=l();y(a,function(d,h,k){var f;p(h)&&"fulfilled"===(f=h.inspect()).state?a[k]=f.value:
(++c,r(h,function(d){a[k]=d;0===--c&&e.resolve(a)},e.reject,function(a){e.notify({index:k,value:a})}))},void 0);0===c&&e.resolve(a);return e.promise})}function Q(a){return r(a,function(a){a=D(a,c);return r(u(D(a,function(a){return r(a,R,R)})),function(){return a})})}var x=!1;try{throw Error();}catch(Z){x=!!Z.stack}var T=K(),J,R=function(){},E=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var g=b.domain;g&&(b.domain=void 0,g.enter());try{c()}catch(d){if(h)throw g&&g.exit(),
setTimeout(a,0),g&&g.enter(),d;setTimeout(function(){throw d;},0)}g&&g.exit()}e=!1}var b={task:void 0,next:null},c=b,e=!1,d=void 0,h=!1;E=function(a){c=c.next={task:a,domain:h&&process.domain,next:null};e||(e=!0,d())};if("undefined"!==typeof process&&process.nextTick)h=!0,d=function(){process.nextTick(a)};else if("function"===typeof setImmediate)d="undefined"!==typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel;
k.port1.onmessage=function(){d=f;k.port1.onmessage=a;a()};var f=function(){k.port2.postMessage(0)},d=function(){setTimeout(a,0);f()}}else d=function(){setTimeout(a,0)};return E}(),S=Function.call,f=n(Array.prototype.slice),y=n(Array.prototype.reduce||function(a,b){var c=0,e=this.length;if(1===arguments.length){do{if(c in this){b=this[c++];break}if(++c>=e)throw new TypeError;}while(1)}for(;c<e;c++)c in this&&(b=a(b,this[c],c));return b}),X=n(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===
a)return b;return-1}),D=n(Array.prototype.map||function(a,b){var c=this,e=[];y(c,function(d,h,k){e.push(a.call(b,h,k,c))},void 0);return e}),B=Object.create||function(a){function b(){}b.prototype=a;return new b},aa=n(Object.prototype.hasOwnProperty),Y=Object.keys||function(a){var b=[],c;for(c in a)aa(a,c)&&b.push(c);return b},ba=n(Object.prototype.toString),F;F="undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};c.resolve=c;c.nextTick=E;c.longStackSupport=!1;"object"===typeof process&&
process&&process.env&&process.env.Q_DEBUG&&(c.longStackSupport=!0);c.defer=l;l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):2<arguments.length?a.resolve(f(arguments,1)):a.resolve(c)}};c.Promise=t;c.promise=t;t.race=N;t.all=u;t.reject=q;t.resolve=c;c.passByCopy=function(a){return a};d.prototype.passByCopy=function(){return this};c.join=function(a,b){return c(a).join(b)};d.prototype.join=function(a){return c([this,a]).spread(function(a,c){if(a===c)return a;throw Error("Can't join: not the same: "+
a+" "+c);})};c.race=N;d.prototype.race=function(){return this.then(c.race)};c.makePromise=d;d.prototype.toString=function(){return"[object Promise]"};d.prototype.then=function(a,b,g){function e(b){try{return"function"===typeof a?a(b):b}catch(c){return q(c)}}function d(a){if("function"===typeof b){G(a,h);try{return b(a)}catch(c){return q(c)}}return q(a)}var h=this,k=l(),f=!1;c.nextTick(function(){h.promiseDispatch(function(a){f||(f=!0,k.resolve(e(a)))},"when",[function(a){f||(f=!0,k.resolve(d(a)))}])});
h.promiseDispatch(void 0,"when",[void 0,function(a){var b,e=!1;try{b="function"===typeof g?g(a):a}catch(d){if(e=!0,c.onerror)c.onerror(d);else throw d;}e||k.notify(b)}]);return k.promise};c.tap=function(a,b){return c(a).tap(b)};d.prototype.tap=function(a){a=c(a);return this.then(function(b){return a.fcall(b).thenResolve(b)})};c.when=r;d.prototype.thenResolve=function(a){return this.then(function(){return a})};c.thenResolve=function(a,b){return c(a).thenResolve(b)};d.prototype.thenReject=function(a){return this.then(function(){throw a;
})};c.thenReject=function(a,b){return c(a).thenReject(b)};c.nearer=M;c.isPromise=p;c.isPromiseAlike=L;c.isPending=function(a){return p(a)&&"pending"===a.inspect().state};d.prototype.isPending=function(){return"pending"===this.inspect().state};c.isFulfilled=function(a){return!p(a)||"fulfilled"===a.inspect().state};d.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state};c.isRejected=function(a){return p(a)&&"rejected"===a.inspect().state};d.prototype.isRejected=function(){return"rejected"===
this.inspect().state};var v=[],z=[],w=!0;c.resetUnhandledRejections=C;c.getUnhandledReasons=function(){return v.slice()};c.stopUnhandledRejectionTracking=function(){C();w=!1};C();c.reject=q;c.fulfill=A;c.master=function(a){return d({isDef:function(){}},function(b,c){return P(a,b,c)},function(){return c(a).inspect()})};c.spread=O;d.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)};c.async=function(a){return function(){function b(a,b){var l;if("undefined"===
typeof StopIteration){try{l=d[a](b)}catch(n){return q(n)}return l.done?c(l.value):r(l.value,e,f)}try{l=d[a](b)}catch(p){return"[object StopIteration]"===ba(p)||p instanceof F?c(p.value):q(p)}return r(l,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}};c.spawn=function(a){c.done(c.async(a)())};c["return"]=function(a){throw new F(a);};c.promised=function(a){return function(){return O([this,u(arguments)],function(b,c){return a.apply(b,c)})}};c.dispatch=P;d.prototype.dispatch=
function(a,b){var d=this,e=l();c.nextTick(function(){d.promiseDispatch(e.resolve,a,b)});return e.promise};c.get=function(a,b){return c(a).dispatch("get",[b])};d.prototype.get=function(a){return this.dispatch("get",[a])};c.set=function(a,b,d){return c(a).dispatch("set",[b,d])};d.prototype.set=function(a,b){return this.dispatch("set",[a,b])};c.del=c["delete"]=function(a,b){return c(a).dispatch("delete",[b])};d.prototype.del=d.prototype["delete"]=function(a){return this.dispatch("delete",[a])};c.mapply=
c.post=function(a,b,d){return c(a).dispatch("post",[b,d])};d.prototype.mapply=d.prototype.post=function(a,b){return this.dispatch("post",[a,b])};c.send=c.mcall=c.invoke=function(a,b){return c(a).dispatch("post",[b,f(arguments,2)])};d.prototype.send=d.prototype.mcall=d.prototype.invoke=function(a){return this.dispatch("post",[a,f(arguments,1)])};c.fapply=function(a,b){return c(a).dispatch("apply",[void 0,b])};d.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])};c["try"]=c.fcall=
function(a){return c(a).dispatch("apply",[void 0,f(arguments,1)])};d.prototype.fcall=function(){return this.dispatch("apply",[void 0,f(arguments)])};c.fbind=function(a){var b=c(a),d=f(arguments,1);return function(){return b.dispatch("apply",[this,d.concat(f(arguments))])}};d.prototype.fbind=function(){var a=this,b=f(arguments);return function(){return a.dispatch("apply",[this,b.concat(f(arguments))])}};c.keys=function(a){return c(a).dispatch("keys",[])};d.prototype.keys=function(){return this.dispatch("keys",
[])};c.all=u;d.prototype.all=function(){return u(this)};c.allResolved=function(a,b,c){return function(){"undefined"!==typeof console&&"function"===typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",Error("").stack);return a.apply(a,arguments)}}(Q,"allResolved","allSettled");d.prototype.allResolved=function(){return Q(this)};c.allSettled=function(a){return c(a).allSettled()};d.prototype.allSettled=function(){return this.then(function(a){return u(D(a,function(a){function d(){return a.inspect()}
a=c(a);return a.then(d,d)}))})};c.fail=c["catch"]=function(a,b){return c(a).then(void 0,b)};d.prototype.fail=d.prototype["catch"]=function(a){return this.then(void 0,a)};c.progress=function(a,b){return c(a).then(void 0,void 0,b)};d.prototype.progress=function(a){return this.then(void 0,void 0,a)};c.fin=c["finally"]=function(a,b){return c(a)["finally"](b)};d.prototype.fin=d.prototype["finally"]=function(a){a=c(a);return this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b;
})})};c.done=function(a,b,d,e){return c(a).done(b,d,e)};d.prototype.done=function(a,b,d){var e=function(a){c.nextTick(function(){G(a,f);if(c.onerror)c.onerror(a);else throw a;})},f=a||b||d?this.then(a,b,d):this;"object"===typeof process&&process&&process.domain&&(e=process.domain.bind(e));f.then(void 0,e)};c.timeout=function(a,b,d){return c(a).timeout(b,d)};d.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){b&&"string"!==typeof b||(b=Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT");
c.reject(b)},a);this.then(function(a){clearTimeout(d);c.resolve(a)},function(a){clearTimeout(d);c.reject(a)},c.notify);return c.promise};c.delay=function(a,b){void 0===b&&(b=a,a=void 0);return c(a).delay(b)};d.prototype.delay=function(a){return this.then(function(b){var c=l();setTimeout(function(){c.resolve(b)},a);return c.promise})};c.nfapply=function(a,b){return c(a).nfapply(b)};d.prototype.nfapply=function(a){var b=l();a=f(a);a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);return b.promise};
c.nfcall=function(a){var b=f(arguments,1);return c(a).nfapply(b)};d.prototype.nfcall=function(){var a=f(arguments),b=l();a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);return b.promise};c.nfbind=c.denodeify=function(a){var b=f(arguments,1);return function(){var d=b.concat(f(arguments)),e=l();d.push(e.makeNodeResolver());c(a).fapply(d).fail(e.reject);return e.promise}};d.prototype.nfbind=d.prototype.denodeify=function(){var a=f(arguments);a.unshift(this);return c.denodeify.apply(void 0,
a)};c.nbind=function(a,b){var d=f(arguments,2);return function(){var e=d.concat(f(arguments)),m=l();e.push(m.makeNodeResolver());c(function(){return a.apply(b,arguments)}).fapply(e).fail(m.reject);return m.promise}};d.prototype.nbind=function(){var a=f(arguments,0);a.unshift(this);return c.nbind.apply(void 0,a)};c.nmapply=c.npost=function(a,b,d){return c(a).npost(b,d)};d.prototype.nmapply=d.prototype.npost=function(a,b){var c=f(b||[]),d=l();c.push(d.makeNodeResolver());this.dispatch("post",[a,c]).fail(d.reject);
return d.promise};c.nsend=c.nmcall=c.ninvoke=function(a,b){var d=f(arguments,2),e=l();d.push(e.makeNodeResolver());c(a).dispatch("post",[b,d]).fail(e.reject);return e.promise};d.prototype.nsend=d.prototype.nmcall=d.prototype.ninvoke=function(a){var b=f(arguments,1),c=l();b.push(c.makeNodeResolver());this.dispatch("post",[a,b]).fail(c.reject);return c.promise};c.nodeify=function(a,b){return c(a).nodeify(b)};d.prototype.nodeify=function(a){if(a)this.then(function(b){c.nextTick(function(){a(null,b)})},
function(b){c.nextTick(function(){a(b)})});else return this};var U=K();return c});